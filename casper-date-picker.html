<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../vaadin-material-theme/vaadin-date-picker.html">
<link rel="import" href="../vaadin-date-picker/vaadin-date-picker.html">

<dom-module id="casper-date-picker">
  <template>
    <vaadin-date-picker
      id="datePicker"
      value="{{value}}"
      min="[[minimumDate]]"
      max="[[maximumDate]]"
      attr-for-value="value">
    </vaadin-date-picker>
  </template>
  <script>

    class CasperDatePicker extends Polymer.Element {
      static get is() {
        return 'casper-date-picker';
      }

      static get properties() {
        return {
          format: {
            type: String,
            value: 'DDMMYYYY'
          },
          minimumDate: {
            type: String,
          },
          maximumDate: {
            type: String,
          },
          value: {
            type: String,
            notify: true,
          },
          _isInputFocused: {
            type: Boolean,
            value: false
          }
        };
      }

      ready () {
        super.ready();

        this._setupDatePicker();
      }

      _setupDatePicker () {
        // Function to format a date into a String and the other way around.
        this.$.datePicker.set('i18n.parseDate', date => this._parseDate(date));
        this.$.datePicker.set('i18n.formatDate', date => this._formatDate(date));

        // Date picker translations.
        this.$.datePicker.set('i18n.monthNames', [
          'Janeiro', 'Fevereiro', 'Março', 'Abril',
          'Maio', 'Junho', 'Julho', 'Agosto',
          'Setembro', 'Outubro', 'Novembro', 'Dezembro'
        ]);

        this.$.datePicker.set('i18n.today', 'Hoje');
        this.$.datePicker.set('i18n.cancel', 'Cancelar');
        this.$.datePicker.set('i18n.weekdaysShort', ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb']);
        this.$.datePicker.set('i18n.weekdays', ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado']);
      }

      _formatDate (date) {
        return moment(new Date(date.year, date.month, date.day)).format(this.format);
      }

      _parseDate (date) {
        const parsedDate = moment(date, this.format).toDate();

        return {
          day: parsedDate.getDate(),
          month: parsedDate.getMonth(),
          year: parsedDate.getFullYear()
        };
      }
    }

    window.customElements.define(CasperDatePicker.is, CasperDatePicker);
  </script>
</dom-module>
